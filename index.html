<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gabungan Data Peralatan Mesin</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
  .navy { color: #001f3f; }
  .bg-navy { background-color: #001f3f; }
  .hover-bg-navy:hover { background-color: #003366; }
</style>
</head>
<body class="bg-gray-50">

<div class="flex min-h-screen">
  <!-- Sidebar -->
  <nav class="w-64 bg-white shadow-md border-r border-gray-200 flex flex-col">
    <div class="px-6 py-4 border-b border-gray-200 text-xl font-semibold text-blue-700">ASET DIKBUD</div>

    <!-- Menu Master Data -->
    <div class="group border-b border-gray-200">
      <a href="#" class="px-6 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 block">Master Data</a>
    </div>

    <!-- Menu KIB Dropdown -->
    <div class="group border-b border-gray-200">
      <button id="kibBtn" class="w-full flex justify-between items-center px-6 py-3 hover:bg-blue-100 focus:outline-none">
        <span class="font-medium text-gray-700">KIB</span>
        <svg id="kibArrow" class="w-4 h-4 text-gray-500 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
      <div id="kibDropdown" class="hidden flex flex-col bg-gray-50 border-t border-gray-200">
        <a href="inputdata.html" class="px-10 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 kib-link">Input KIB B</a>
        <a href="#" class="px-10 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 kib-link">Input KIB C</a>
      </div>
    </div>

    <!-- Menu Kecamatan Dropdown -->
    <div class="group border-b border-gray-200">
      <button id="kecamatanBtn" class="w-full flex justify-between items-center px-6 py-3 hover:bg-blue-100 focus:outline-none">
        <span class="font-medium text-gray-700">Kecamatan</span>
        <svg id="kecamatanArrow" class="w-4 h-4 text-gray-500 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
      <ul id="kecamatanDropdown" class="hidden flex-col border-t border-gray-200 bg-gray-50">
        <li data-kecamatan="Banawa" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Banawa</li>
        <li data-kecamatan="Banawa Tengah" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Banawa Tengah</li>
        <li data-kecamatan="Banawa Selatan" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Banawa Selatan</li>
        <li data-kecamatan="Rio Pakava" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Rio Pakava</li>
        <li data-kecamatan="Pinembani" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Pinembani</li>
        <li data-kecamatan="Tanantovea" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Tanantovea</li>
        <li data-kecamatan="Labuan" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Labuan</li>
        <li data-kecamatan="Sindue" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Sindue</li>
        <li data-kecamatan="Sindue Tombusabora" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Sindue Tombusabora</li>
        <li data-kecamatan="Sindue Tobata" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Sindue Tobata</li>
        <li data-kecamatan="Sirenja" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Sirenja</li>
        <li data-kecamatan="Balaesang" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Balaesang</li>
        <li data-kecamatan="Balaesang Tanjung" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Balaesang Tanjung</li>
        <li data-kecamatan="Dampelas" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Dampelas</li>
        <li data-kecamatan="Sojol" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Sojol</li>
        <li data-kecamatan="Sojol Utara" class="px-10 py-2 hover:text-blue-600 hover:bg-blue-50">Kecamatan Sojol Utara</li>
      </ul>
    </div>

    <!-- Menu Rekapan Kabupaten -->
    <div class="group border-b border-gray-200">
      <a href="#" class="px-6 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 block">Rekapan Kabupaten</a>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="flex-1 p-6">
    <h2 class="text-center text-3xl font-bold mb-4 navy">Gabungan Data Peralatan Mesin</h2>

    <div class="mb-2 text-gray-700 font-medium" id="dataCount">Loading data...</div>

    <div class="mb-4 flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
      <div>
        <button id="downloadExcel" class="bg-navy hover-bg-navy text-white px-4 py-2 rounded shadow-md mr-2">Download Excel</button>
        <button id="downloadPdf" class="bg-navy hover-bg-navy text-white px-4 py-2 rounded shadow-md">Download PDF</button>
      </div>
      <div>
        <input type="text" id="searchInput" placeholder="Cari..." class="border rounded px-4 py-2 w-full md:w-80">
      </div>
    </div>

    <div class="overflow-x-auto bg-white rounded shadow-md">
      <table id="dataTable" class="min-w-full table-auto border border-gray-300">
        <thead>
          <tr class="bg-navy text-white">
            <th class="border px-4 py-2">Urut</th>
            <th class="border px-4 py-2">Pengguna Barang</th>
            <th class="border px-4 py-2">Kode Barang</th>
            <th class="border px-4 py-2">Nama Barang</th>
            <th class="border px-4 py-2">Konfirmasi Keberadaan</th>
            <th class="border px-4 py-2">Kondisi</th>
            <th class="border px-4 py-2">Label BMD</th>
            <th class="border px-4 py-2">Penggunaan</th>
            <th class="border px-4 py-2">Nama Pengguna</th>
            <th class="border px-4 py-2">Status Pegawai Pengguna</th>
            <th class="border px-4 py-2">Keterangan Tambahan</th>
            <th class="border px-4 py-2">NIBAR</th>
            <th class="border px-4 py-2">Merek/Tipe</th>
            <th class="border px-4 py-2">Nomor Polisi</th>
            <th class="border px-4 py-2">Nomor Rangka</th>
            <th class="border px-4 py-2">Nomor BPKB</th>
            <th class="border px-4 py-2">Nilai Perolehan</th>
            <th class="border px-4 py-2">Cara Perolehan</th>
            <th class="border px-4 py-2">Perolehan</th>
            <th class="border px-4 py-2">Status Penggunaan</th>
          </tr>
        </thead>
        <tbody class="text-gray-700">
          <tr><td colspan="20" class="text-center py-8">Loading data...</td></tr>
        </tbody>
      </table>
    </div>

    <div id="pagination" class="flex justify-center mt-6 space-x-2"></div>
  </div>
</div>

<script>
// Sidebar Dropdown
document.getElementById('kibBtn').addEventListener('click', ()=>{
  const dropdown = document.getElementById('kibDropdown');
  const arrow = document.getElementById('kibArrow');
  dropdown.classList.toggle('hidden');
  arrow.classList.toggle('rotate-90');
});

document.getElementById('kecamatanBtn').addEventListener('click', ()=>{
  const dropdown = document.getElementById('kecamatanDropdown');
  const arrow = document.getElementById('kecamatanArrow');
  dropdown.classList.toggle('hidden');
  arrow.classList.toggle('rotate-90');
});

<script>
// Array CSV publik dari semua sheet
const csvUrls = [
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vRd8vIhHDUbmD6I2aXLX7-_Ysemt2aXA__wKNGoKN0XWWSWCScv5aSmx06H0xkl8g/pub?gid=1917777904&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vRnykw5e_i3dwBIeTua-mpFExEJ4w6hROJ5F6OUHiiGpbtunldeKgXlhN_G-D1V8w/pub?gid=1454720232&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vRhDJK33BtCz7KEi6DWgqheZBrcdgK0X9Pw1r28u5ec1MK-I-kP-QOqrsY0G2OnEQ/pub?gid=708970016&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vQshgCYmG0DHxcwLUzhtUamXTYnWb8tR7WQwnJq9k7ldFz_JhV4GHDE-k_dMO_pSA/pub?gid=1860451546&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vR3MhjBMD3q8UIfOTdAUOHKMdeGcwr3y2YQGFcDmHDd0IVsOsAECl511LsNJ9ynow9cmY4yBpP1jENa/pub?gid=1200528899&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vT7WqNsmpUBIy0-lVm2JdGg1KUKwNgQPpbSyDuuFDwB1aGPY8gsZSBWmxIgiOeJNA/pub?gid=1615242439&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2sjcmJjTCYD3p6-7pDQTmm3mCVphZIP2-5DGZOHxStucexMcdqPVsfsbnDouFcA/pub?gid=1920885371&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vRYHOyrOQ_hNjC1L1FoIMVbbWES0dPGb1OaU6V--PV_lm0O97IHFvtPRhgRNXn_dA/pub?gid=1974330298&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vQIbvzs-jZRcf1z0uV_Ahwh6dNdBgBHw66T358D9wd0-DHimDs8r4ajCvZwLa8Srg/pub?gid=801352666&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vROhU6H6reNQxHKsAmYYgfcaSZyis1vALTmBkYhjAp7BGX_wNdA2cVdgOjFQIIgjQ/pub?output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vQIf6mV6qgS6fmRe3jz305N8wCDdKWJcKKWSxHtybbo7xoERx15unD-x4rgyFxF-g/pub?gid=1401841928&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vQRojLHXJ4W6IEdiNn34kZrMgr5QvPZllm85-sbgD0WxjG6vFMUMQz3QzzGnM-7pw/pub?gid=820099832&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vR_BmCgfv-HOMRKzNMZ1aHL05CZsR7Ie0VZGRJTD29tX1C-ANiKASW1hB_PM69WuQ/pub?gid=1489077321&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vT64A3AbrmT4TK8fLj5ctUc3LLMESXVTOuw3nBd2qRTEFIljaxTBW3-Z5u4w7W2Ng/pub?gid=1781390946&single=true&output=csv',
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vT41KwECicPb2EY8d8BP1f73RM3dhVWYDOxpaFlHZluKFy9owLzyVX7N7mIUm37Tw/pub?gid=502544387&single=true&output=csv'
];

let currentData = [];
let filteredData = [];
let currentPage = 1;
const itemsPerPage = 100;

// Load & gabungkan semua CSV
async function loadAllData() {
  currentData = [];
  try {
    for (const url of csvUrls) {
      const res = await fetch(url);
      const text = await res.text();
      const results = Papa.parse(text, { header: true, skipEmptyLines: true });
      const mapped = results.data.map(row => ({
        "Urut": row["Urut"] || '',
        "Pengguna Barang": row["Pengguna Barang"] || '',
        "Kode Barang": row["Kode Barang"] || '',
        "Nama Barang": row["Nama Barang"] || '',
        "Konfirmasi Keberadaan": row["Konfirmasi Keberadaan"] || '',
        "Kondisi": row["Kondisi"] || '',
        "Label BMD": row["Label BMD\n(selain Kendaraan)"] || '',
        "Penggunaan": row["Penggunaan"] || '',
        "Nama Pengguna": row["Nama Pengguna\n(Jika Penggunaan : Digunakan Pegawai)"] || '',
        "Status Pegawai Pengguna": row["Status Pegawai Pengguna\n(Jika Penggunaan : Digunakan Pegawai)"] || '',
        "Keterangan Tambahan": row["Keterangan Tambahan"] || '',
        "NIBAR": row["NIBAR"] || '',
        "Merek/Tipe": row["Merek/tipe"] || '',
        "Nomor Polisi": row["Nomor Polisi"] || '',
        "Nomor Rangka": row["Nomor Rangka"] || '',
        "Nomor BPKB": row["Nomor BPKB"] || '',
        "Nilai Perolehan": row["Nilai Perolehan"] || '',
        "Cara Perolehan": row["Cara Perolehan"] || '',
        "Perolehan": row["Perolehan"] || '',
        "Status Penggunaan": row["Status Penggunaan"] || ''
      }));
      currentData = currentData.concat(mapped);
    }
    filteredData = currentData;
    currentPage = 1;
    renderTable();
  } catch (err) {
    console.error("Error load CSV:", err);
  }
}

function updateDataCount(){
  const countDiv = document.getElementById('dataCount');
  countDiv.textContent = `Menampilkan ${filteredData.length} data`;
}

function renderTable() {
  const tbody = document.querySelector('#dataTable tbody');
  tbody.innerHTML = '';
  if(filteredData.length === 0){
    tbody.innerHTML = '<tr><td colspan="20" class="text-center py-8">Tidak ada data</td></tr>';
  } else {
    const startIdx = (currentPage -1)*itemsPerPage;
    const pageData = filteredData.slice(startIdx, startIdx+itemsPerPage);

    pageData.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = Object.values(row).map(val=>`<td class="border px-4 py-2">${val||''}</td>`).join('');
      tbody.appendChild(tr);
    });
  }
  updateDataCount();
  renderPagination();
}

function renderPagination() {
  const totalPages = Math.ceil(filteredData.length/itemsPerPage);
  const paginationDiv = document.getElementById('pagination');
  paginationDiv.innerHTML = '';

  if(totalPages <=1) return;

  const prevBtn = `<button class="px-3 py-1 bg-navy text-white rounded ${currentPage===1?'opacity-50':''}" ${currentPage===1?'disabled':''} onclick="goToPage(${currentPage-1})">Prev</button>`;
  const nextBtn = `<button class="px-3 py-1 bg-navy text-white rounded ${currentPage===totalPages?'opacity-50':''}" ${currentPage===totalPages?'disabled':''} onclick="goToPage(${currentPage+1})">Next</button>`;
  paginationDiv.innerHTML += prevBtn;

  for(let i=1;i<=totalPages;i++){
    paginationDiv.innerHTML += `<button class="px-3 py-1 ${i===currentPage?'bg-blue-700 text-white':'bg-gray-200'} rounded" onclick="goToPage(${i})">${i}</button>`;
  }

  paginationDiv.innerHTML += nextBtn;
}

function goToPage(page){ currentPage=page; renderTable(); }

document.getElementById('searchInput').addEventListener('input', function(){
  const query = this.value.toLowerCase();
  filteredData = currentData.filter(row => Object.values(row).some(v=>(v||'').toLowerCase().includes(query)));
  currentPage=1; renderTable();
});

document.getElementById('downloadExcel').addEventListener('click', ()=> {
  if(!currentData.length){ alert('Data belum dimuat.'); return;}
  const worksheet = XLSX.utils.json_to_sheet(currentData);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'GabunganPeralatanMesin');
  XLSX.writeFile(workbook, 'Gabungan_Peralatan_Mesin.xlsx');
});

document.getElementById('downloadPdf').addEventListener('click', ()=> {
  if(!currentData.length){ alert('Data belum dimuat.'); return;}
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('l', 'pt', 'a4');
  const columns = Object.keys(currentData[0]);
  const pdfData = currentData.map(row => columns.map(k=>row[k]||''));
  doc.autoTable({ head:[columns], body:pdfData, startY:20, styles:{fontSize:8}, headStyles:{fillColor:[0,31,63]}});
  doc.save('Gabungan_Peralatan_Mesin.pdf');
});

loadAllData();
// auto refresh 30 detik
setInterval(loadAllData, 30000);
</script>

</body>
</html>

